# 开发流程

主要包含日常开发的一些文档，方便快速了解项目结构，形成统一开发流程。

## 工程结构

目前只在p3d-pmd项目下做开发，忽略checkstyle等其他目录，与普通的Java工程类似，主要分为4个主要的部分：

### src/main/java

Java规则类放在com.alibaba.p3c.pmd.lang.java.rule下，根据自己的类别新建目录，如”注释规约“放在comments目录下，”并发处理“放置在concurrent目录下。

### src/main/resources

xml规则配置文件放在rulesets/java下，每个类别一个文件，每个文件包含多条规则。pmd默认会在这个目录读取配置文件。

### src/test/java

测试类放在com.alibaba.p3c.pmd.lang.java.rule下，工程结构与实现类相似。一般的测试类相对比较简单，将自己实现的规则添加到要测试的规则集即可，主要的工作下测试用例上。

### src/test/resources

测试用例放在com/alibaba/p3c/pmd/lang/java/rule下，每个类别新建目录，测试用例放在子目录xml目录下。

## 代码审核

### ak客户端安装

使用Aone代码审核系统来提交Code Review，需要安装ak客户端，简单步骤如下：

1. 安装php，最好是5.5或5.6版本
2. git clone git@gitlab.alibaba-inc.com:phabricator/pha-all.git
3. 将pha-all/arcanist/bin添加到环境变量

完成上述步骤后，运行ak —help验证是否安装成功。关于ak客户端安装更完善的[文档链接](https://aone.alibaba-inc.com/code/w/differential/install-ak/)。

### ak客户端使用

使用在feature分支上开发，code review完毕后提交master的流程。

```
git checkout master    # 进入 master branch
git pull               # 确保 master 是最新版本
git branch tmp_branch       # git工作方式是，为每一个feature创建一个branch
git checkout tmp_branch       # 进入 tmp_branch
... （写代码） ...
git commit -a          # 生成一个 commit
ak diff               # 生成一个 diff
... （在 代码审核 里做 diff review） ...
... （继续修改代码，ak diff
ak land               # 把代码变动 merge 进 master 然后上传
```

ak客户端主要两个命令：

* ak diff：将当前分支与origin/master分支对比，提交code review。


* ak land:  将昂前分支merge到master，并push。

在提交code review时，可以通过在summary里填写 ref T123, T234来关联代码实现的任务。

采用本地跑单元测试的方式，确保提交code review时，单元测试都是通过状态。

